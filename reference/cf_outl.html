<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Identify Outlier Records in Space and Time — cf_outl • CoordinateCleaner</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Identify Outlier Records in Space and Time — cf_outl" />
<meta property="og:description" content="Removes or flags records of fossils that are spatio-temporal outliers based on
interquantile ranges. Records are flagged if they are either extreme in time
or space, or both." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">CoordinateCleaner</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.0-20</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/Cleaning_GBIF_data_with_CoordinateCleaner.html">Cleaning GBIF data for the use in biogeography</a>
    </li>
    <li>
      <a href="../articles/Cleaning_PBDB_fossils_with_CoordinateCleaner.html">Cleaning fossil data for the use in biogeography and palaeontology</a>
    </li>
    <li>
      <a href="../articles/Comparison_other_software.html">Comparison of CoordinateCleaner to other tools</a>
    </li>
    <li>
      <a href="../articles/Using_custom_gazetteers.html">Using customized gazetteers</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/ropensci/CoordinateCleaner/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Identify Outlier Records in Space and Time</h1>
    <small class="dont-index">Source: <a href='https://github.com/ropensci/CoordinateCleaner/blob/master/R/cf_outl.R'><code>R/cf_outl.R</code></a></small>
    <div class="hidden name"><code>cf_outl.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Removes or flags records of fossils that are spatio-temporal outliers based on
interquantile ranges. Records are flagged if they are either extreme in time
or space, or both.</p>
    </div>

    <pre class="usage"><span class='fu'>cf_outl</span><span class='op'>(</span>
  <span class='va'>x</span>,
  lon <span class='op'>=</span> <span class='st'>"decimallongitude"</span>,
  lat <span class='op'>=</span> <span class='st'>"decimallatitude"</span>,
  min_age <span class='op'>=</span> <span class='st'>"min_ma"</span>,
  max_age <span class='op'>=</span> <span class='st'>"max_ma"</span>,
  taxon <span class='op'>=</span> <span class='st'>"accepted_name"</span>,
  method <span class='op'>=</span> <span class='st'>"quantile"</span>,
  size_thresh <span class='op'>=</span> <span class='fl'>7</span>,
  mltpl <span class='op'>=</span> <span class='fl'>5</span>,
  replicates <span class='op'>=</span> <span class='fl'>5</span>,
  flag_thresh <span class='op'>=</span> <span class='fl'>0.5</span>,
  uniq_loc <span class='op'>=</span> <span class='cn'>FALSE</span>,
  value <span class='op'>=</span> <span class='st'>"clean"</span>,
  verbose <span class='op'>=</span> <span class='cn'>TRUE</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>data.frame. Containing fossil records with taxon names, ages, 
and geographic coordinates.</p></td>
    </tr>
    <tr>
      <th>lon</th>
      <td><p>character string. The column with the longitude coordinates.
To identify unique records if <code>uniq_loc  = TRUE</code>.
Default = &#8220;decimallongitude&#8221;.</p></td>
    </tr>
    <tr>
      <th>lat</th>
      <td><p>character string. The column with the longitude coordinates.
Default = &#8220;decimallatitude&#8221;. To identify unique records if <code>uniq_loc  = T</code>.</p></td>
    </tr>
    <tr>
      <th>min_age</th>
      <td><p>character string. The column with the minimum age. Default
= &#8220;min_ma&#8221;.</p></td>
    </tr>
    <tr>
      <th>max_age</th>
      <td><p>character string. The column with the maximum age. Default
= &#8220;max_ma&#8221;.</p></td>
    </tr>
    <tr>
      <th>taxon</th>
      <td><p>character string. The column with the taxon name. If
&#8220;&#8221;, searches for outliers over the entire dataset, otherwise per
specified taxon. Default = &#8220;accepted_name&#8221;.</p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p>character string.  Defining the method for outlier
selection.  See details. Either &#8220;quantile&#8221; or &#8220;mad&#8221;.  Default
= &#8220;quantile&#8221;.</p></td>
    </tr>
    <tr>
      <th>size_thresh</th>
      <td><p>numeric.  The minimum number of records needed for a
dataset to be tested. Default = 10.</p></td>
    </tr>
    <tr>
      <th>mltpl</th>
      <td><p>numeric. The multiplier of the interquartile range
(<code>method == 'quantile'</code>) or median absolute deviation (<code>method ==
'mad'</code>) to identify outliers. See details.  Default = 5.</p></td>
    </tr>
    <tr>
      <th>replicates</th>
      <td><p>numeric. The number of replications for the distance
matrix calculation. See details.  Default = 5.</p></td>
    </tr>
    <tr>
      <th>flag_thresh</th>
      <td><p>numeric.  The fraction of passed replicates necessary to pass the test. 
See details. Default = 0.5.</p></td>
    </tr>
    <tr>
      <th>uniq_loc</th>
      <td><p>logical.  If TRUE only single records per location and time
point (and taxon if <code>taxon</code> != "") are used for the outlier testing.
Default = T.</p></td>
    </tr>
    <tr>
      <th>value</th>
      <td><p>character string.  Defining the output value. See value.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>logical. If TRUE reports the name of the test and the number
of records flagged.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>Depending on the &#8216;value&#8217; argument, either a <code>data.frame</code>
containing the records considered correct by the test (&#8220;clean&#8221;) or a
logical vector (&#8220;flagged&#8221;), with TRUE = test passed and FALSE = test failed/potentially
problematic . Default = &#8220;clean&#8221;.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The outlier detection is based on an interquantile range test. In a first
step a distance matrix of geographic distances among all records is
calculate. Subsequently a similar distance matrix of temporal distances
among all records is calculated based on a single point selected by random
between the minimum and maximum age for each record. The mean distance for
each point to all neighbours is calculated for both matrices and spatial and
temporal distances are scaled to the same range. The sum of these distanced
is then tested against the interquantile range and flagged as an outlier if
\(x &gt; IQR(x) + q_75 * mltpl\). The test is replicated &#8216;replicates&#8217;
times, to account for temporal uncertainty. Records are flagged as outliers
if they are flagged by a fraction of more than &#8216;flag.thres&#8217;
replicates. Only datasets/taxa comprising more than &#8216;size_thresh&#8217;
records are tested. Note that geographic distances are calculated as
geospheric distances for datasets (or taxa) with fewer than 10,000 records
and approximated as Euclidean distances for datasets/taxa with 10,000 to
25,000 records. Datasets/taxa comprising more than 25,000 records are
skipped.</p>
    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p>See <a href='https://ropensci.github.io/CoordinateCleaner/'>https://ropensci.github.io/CoordinateCleaner/</a> for more
details and tutorials.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>Other fossils: 
<code><a href='cf_age.html'>cf_age</a>()</code>,
<code><a href='cf_equal.html'>cf_equal</a>()</code>,
<code><a href='cf_range.html'>cf_range</a>()</code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='va'>minages</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span><span class='op'>(</span>n <span class='op'>=</span> <span class='fl'>11</span>, min <span class='op'>=</span> <span class='fl'>10</span>, max <span class='op'>=</span> <span class='fl'>25</span><span class='op'>)</span>, <span class='fl'>62.5</span><span class='op'>)</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>species <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>letters</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>10</span><span class='op'>]</span>, <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='st'>"z"</span>, <span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span>,
                lng <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span><span class='op'>(</span>n <span class='op'>=</span> <span class='fl'>10</span>, min <span class='op'>=</span> <span class='fl'>4</span>, max <span class='op'>=</span> <span class='fl'>16</span><span class='op'>)</span>, <span class='fl'>75</span>, <span class='fl'>7</span><span class='op'>)</span>,
                lat <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span><span class='op'>(</span>n <span class='op'>=</span> <span class='fl'>12</span>, min <span class='op'>=</span> <span class='op'>-</span><span class='fl'>5</span>, max <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span><span class='op'>)</span>,
                min_ma <span class='op'>=</span> <span class='va'>minages</span>, 
                max_ma <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>minages</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>11</span><span class='op'>]</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span><span class='op'>(</span>n <span class='op'>=</span> <span class='fl'>11</span>, min <span class='op'>=</span> <span class='fl'>0</span>, max <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span>, <span class='fl'>65</span><span class='op'>)</span><span class='op'>)</span>

<span class='fu'>cf_outl</span><span class='op'>(</span><span class='va'>x</span>, value <span class='op'>=</span> <span class='st'>"flagged"</span>, taxon <span class='op'>=</span> <span class='st'>""</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>Testing spatio-temporal outliers on dataset level</span></div><div class='output co'>#&gt; <span class='warning'>Warning: decimallatitude not found. Using lat instead.</span></div><div class='output co'>#&gt; <span class='warning'>Warning: decimallongitude not found. Using lng instead.</span></div><div class='output co'>#&gt; <span class='message'>Flagged 2 records.</span></div><div class='output co'>#&gt;     1     2     3     4     5     6     7     8     9    10    11    12 
#&gt;  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE FALSE </div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Alexander Zizka.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


