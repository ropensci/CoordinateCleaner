<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Geographic and Temporal Cleaning of Records from Fossil Collections — clean_fossils • CoordinateCleaner</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Geographic and Temporal Cleaning of Records from Fossil Collections — clean_fossils"><meta property="og:description" content="Cleaning records by multiple empirical tests to flag potentially erroneous
coordinates and time-spans, addressing issues common in fossil collection
databases. Individual tests can be activated via the tests argument:"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">CoordinateCleaner</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.0-20</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/Cleaning_GBIF_data_with_CoordinateCleaner.html">Cleaning GBIF data for the use in biogeography</a>
    </li>
    <li>
      <a href="../articles/Cleaning_PBDB_fossils_with_CoordinateCleaner.html">Cleaning fossil data for the use in biogeography and palaeontology</a>
    </li>
    <li>
      <a href="../articles/Comparison_other_software.html">Comparison of CoordinateCleaner to other tools</a>
    </li>
    <li>
      <a href="../articles/Using_custom_gazetteers.html">Using customized gazetteers</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/ropensci/CoordinateCleaner/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Geographic and Temporal Cleaning of Records from Fossil Collections</h1>
    <small class="dont-index">Source: <a href="https://github.com/ropensci/CoordinateCleaner/blob/HEAD/R/clean_fossils.R" class="external-link"><code>R/clean_fossils.R</code></a></small>
    <div class="hidden name"><code>clean_fossils.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Cleaning records by multiple empirical tests to flag potentially erroneous
coordinates and time-spans, addressing issues common in fossil collection
databases. Individual tests can be activated via the tests argument:</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">clean_fossils</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  lon <span class="op">=</span> <span class="st">"lng"</span>,</span>
<span>  lat <span class="op">=</span> <span class="st">"lat"</span>,</span>
<span>  min_age <span class="op">=</span> <span class="st">"min_ma"</span>,</span>
<span>  max_age <span class="op">=</span> <span class="st">"max_ma"</span>,</span>
<span>  taxon <span class="op">=</span> <span class="st">"accepted_name"</span>,</span>
<span>  tests <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"agesequal"</span>, <span class="st">"centroids"</span>, <span class="st">"equal"</span>, <span class="st">"gbif"</span>, <span class="st">"institutions"</span>, <span class="st">"spatiotemp"</span>,</span>
<span>    <span class="st">"temprange"</span>, <span class="st">"validity"</span>, <span class="st">"zeros"</span><span class="op">)</span>,</span>
<span>  countries <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  centroids_rad <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  centroids_detail <span class="op">=</span> <span class="st">"both"</span>,</span>
<span>  inst_rad <span class="op">=</span> <span class="fl">0.001</span>,</span>
<span>  outliers_method <span class="op">=</span> <span class="st">"quantile"</span>,</span>
<span>  outliers_threshold <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  outliers_size <span class="op">=</span> <span class="fl">7</span>,</span>
<span>  outliers_replicates <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  zeros_rad <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  centroids_ref <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  country_ref <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  inst_ref <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  value <span class="op">=</span> <span class="st">"spatialvalid"</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  report <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>x</dt>
<dd><p>data.frame. Containing fossil records, containing taxon names, ages,
and geographic coordinates..</p></dd>


<dt>lon</dt>
<dd><p>character string. The column with the longitude coordinates.
Default = “decimallongitude”.</p></dd>


<dt>lat</dt>
<dd><p>character string. The column with the latitude coordinates.
Default = “decimallatitude”.</p></dd>


<dt>min_age</dt>
<dd><p>character string. The column with the minimum age. Default
= “min_ma”.</p></dd>


<dt>max_age</dt>
<dd><p>character string. The column with the maximum age. Default
= “max_ma”.</p></dd>


<dt>taxon</dt>
<dd><p>character string. The column with the taxon name. If
“”, searches for outliers over the entire dataset, otherwise per
specified taxon. Default = “accepted_name”.</p></dd>


<dt>tests</dt>
<dd><p>vector of character strings, indicating which tests to run.
See details for all tests available. Default = c("centroids",
"equal", "gbif", "institutions", "temprange", "spatiotemp", "agesequal", "zeros")</p></dd>


<dt>countries</dt>
<dd><p>a character string. The column with the country assignment of
each record in three letter ISO code. Default = “countrycode”. If missing, the
countries test is skipped.</p></dd>


<dt>centroids_rad</dt>
<dd><p>numeric. The radius around centroid coordinates in
meters. Default = 1000.</p></dd>


<dt>centroids_detail</dt>
<dd><p>a <code>character string</code>. If set to
‘country’ only country (adm-0) centroids are tested, if set to
‘provinces’ only province (adm-1) centroids are tested.  Default =
‘both’.</p></dd>


<dt>inst_rad</dt>
<dd><p>numeric. The radius around biodiversity institutions
coordinates in metres. Default = 100.</p></dd>


<dt>outliers_method</dt>
<dd><p>The method used for outlier testing. See details.</p></dd>


<dt>outliers_threshold</dt>
<dd><p>numerical.  The multiplier for the interquantile
range for outlier detection. The higher the number, the more conservative
the outlier tests.  See <code><a href="cf_outl.html">cf_outl</a></code> for details. Default = 3.</p></dd>


<dt>outliers_size</dt>
<dd><p>numerical.  The minimum number of records in a dataset
to run the taxon-specific outlier test.  Default = 7.</p></dd>


<dt>outliers_replicates</dt>
<dd><p>numeric. The number of replications for the
distance matrix calculation. See details.  Default = 5.</p></dd>


<dt>zeros_rad</dt>
<dd><p>numeric. The radius around 0/0 in degrees. Default = 0.5.</p></dd>


<dt>centroids_ref</dt>
<dd><p>a <code>data.frame</code> with alternative reference data for
the centroid test. If NULL, the <code>countryref</code> dataset is used.
Alternatives must be identical in structure.</p></dd>


<dt>country_ref</dt>
<dd><p>a <code>SpatialPolygonsDataFrame</code> as alternative
reference for the countries test. If NULL, the
<code>rnaturalearth:ne_countries('medium')</code> dataset is used.</p></dd>


<dt>inst_ref</dt>
<dd><p>a <code>data.frame</code> with alternative reference data for the
biodiversity institution test. If NULL, the <code>institutions</code> dataset
is used.  Alternatives must be identical in structure.</p></dd>


<dt>value</dt>
<dd><p>a character string defining the output value. See the value
section for details. one of ‘spatialvalid’, ‘summary’,
‘clean’. Default = ‘<code>spatialvalid</code>’.</p></dd>


<dt>verbose</dt>
<dd><p>logical. If TRUE reports the name of the test and the number
of records flagged.</p></dd>


<dt>report</dt>
<dd><p>logical or character.  If TRUE a report file is written to the
working directory, summarizing the cleaning results. If a character, the
path to which the file should be written.  Default = FALSE.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>Depending on the output argument:</p><dl><dt>“spatialvalid”</dt>
<dd><p>an object of class <code>spatialvalid</code> similar to x
with one column added for each test. TRUE = clean coordinate entry, FALSE = potentially
problematic coordinate entries.  The .summary column is FALSE if any test flagged
the respective coordinate.</p></dd>

<dt>“flagged”</dt>
<dd><p>a logical vector with the
same order as the input data summarizing the results of all test. TRUE =
clean coordinate, FALSE = potentially problematic (= at least one test
failed).</p></dd>

<dt>“clean”</dt>
<dd><p>a <code>data.frame</code> similar to x
with potentially problematic records removed</p></dd>


</dl></div>
    <div id="details">
    <h2>Details</h2>
    
<ul><li><p>agesequal tests for equal minimum and maximum age.</p></li>
<li><p>centroids tests a radius around country centroids.
The radius is <code>centroids_rad</code>.</p></li>
<li><p>countries tests if coordinates are from the
country indicated in the country column.  <em>Switched off by default.</em></p></li>
<li><p>equal tests for equal absolute longitude and latitude.</p></li>
<li><p>gbif tests a one-degree radius around the GBIF
headquarters in Copenhagen, Denmark.</p></li>
<li><p>institutions tests a radius around known
biodiversity institutions from <code>instiutions</code>. The radius is
<code>inst_rad</code>.</p></li>
<li><p>spatiotemp test for records which are outlier in time and space. See below for details.</p></li>
<li><p>temprange tests for records with unexpectedly large temporal ranges,
using a quantile-based outlier test.</p></li>
<li><p>validity checks if coordinates correspond to a lat/lon coordinate reference system.
This test is always on, since all records need to pass for any other test to run.</p></li>
<li><p>zeros tests for plain zeros, equal latitude and
longitude and a radius around the point 0/0. The radius is <code>zeros_rad</code>.
The outlier detection in ‘spatiotemp’ is based on an interquantile range test. In a first
step a distance matrix of geographic distances among all records is
calculate. Subsequently a similar distance matrix of temporal distances
among all records is calculated based on a single point selected by random
between the minimum and maximum age for each record. The mean distance for
each point to all neighbours is calculated for both matrices and spatial and
temporal distances are scaled to the same range. The sum of these distanced
is then tested against the interquantile range and flagged as an outlier if
\(x &gt; IQR(x) + q_75 * mltpl\). The test is replicated ‘replicates’
times, to account for temporal uncertainty. Records are flagged as outliers
if they are flagged by a fraction of more than ‘flag_thresh’
replicates. Only datasets/taxa comprising more than ‘size.thresh’
records are tested. Note that geographic distances are calculated as
geospheric distances for datasets (or taxa) with fewer than 10,000 records
and approximated as Euclidean distances for datasets/taxa with 10,000 to
25,000 records. Datasets/taxa comprising more than 25,000 records are
skipped.</p></li>
</ul></div>
    <div id="note">
    <h2>Note</h2>
    <p>Always tests for coordinate validity: non-numeric or missing
coordinates and coordinates exceeding the global extent (lon/lat, WGS84).</p>
<p>See <a href="https://ropensci.github.io/CoordinateCleaner/" class="external-link">https://ropensci.github.io/CoordinateCleaner/</a> for more details
and tutorials.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>Other Wrapper functions: 
<code><a href="clean_coordinates.html">clean_coordinates</a>()</code>,
<code><a href="clean_dataset.html">clean_dataset</a>()</code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">minages</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">250</span>, <span class="fl">0</span>, <span class="fl">65</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">exmpl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>accepted_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">letters</span>, size <span class="op">=</span> <span class="fl">250</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                    lng <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">250</span>, min <span class="op">=</span> <span class="fl">42</span>, max <span class="op">=</span> <span class="fl">51</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                    lat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">250</span>, min <span class="op">=</span> <span class="op">-</span><span class="fl">26</span>, max <span class="op">=</span> <span class="op">-</span><span class="fl">11</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                    min_ma <span class="op">=</span> <span class="va">minages</span>,</span></span>
<span class="r-in"><span>                    max_ma <span class="op">=</span> <span class="va">minages</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">250</span>, <span class="fl">0.1</span>, <span class="fl">65</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">test</span> <span class="op">&lt;-</span> <span class="fu">clean_fossils</span><span class="op">(</span>x <span class="op">=</span> <span class="va">exmpl</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Testing coordinate validity</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Flagged 0 records.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Testing equal lat/lon</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Flagged 0 records.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Testing zero coordinates</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Flagged 0 records.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Testing country centroids</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Flagged 0 records.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Testing spatio-temporal outliers on taxon level</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>decimallatitude not found. Using lat instead.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>decimallongitude not found. Using lng instead.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Flagged 0 records.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>decimallatitude not found. Using lat instead.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>decimallongitude not found. Using lng instead.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Testing temporal range outliers on dataset level</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Flagged 0 records.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>decimallatitude not found. Using lat instead.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>decimallongitude not found. Using lng instead.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Testing temporal range outliers on taxon level</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Flagged 0 records.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Testing age validity</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Flagged 0 records.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Testing GBIF headquarters, flagging records around Copenhagen</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Flagged 0 records.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Testing biodiversity institutions</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Flagged 0 records.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Flagged 0 of 250 records, EQ = 0</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">test</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     .aeq     .cen     .equ     .gbf    .inst     .spt     .trg     .zer </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        0        0        0        0        0        0        0        0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .summary </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        0 </span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Alexander Zizka.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer></div>

  


  

  </body></html>

