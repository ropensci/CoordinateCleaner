<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Identify Fossils with Outlier Age — cf_age • CoordinateCleaner</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Identify Fossils with Outlier Age — cf_age"><meta property="og:description" content="Removes or flags records that are temporal outliers based on
interquantile ranges."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">CoordinateCleaner</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/Cleaning_GBIF_data_with_CoordinateCleaner.html">Cleaning GBIF data for the use in biogeography</a>
    </li>
    <li>
      <a href="../articles/Cleaning_PBDB_fossils_with_CoordinateCleaner.html">Cleaning fossil data for the use in biogeography and palaeontology</a>
    </li>
    <li>
      <a href="../articles/Comparison_other_software.html">Comparison of CoordinateCleaner to other tools</a>
    </li>
    <li>
      <a href="../articles/Using_custom_gazetteers.html">Using customized gazetteers</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/ropensci/CoordinateCleaner/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Identify Fossils with Outlier Age</h1>
    <small class="dont-index">Source: <a href="https://github.com/ropensci/CoordinateCleaner/blob/HEAD/R/cf_age.R" class="external-link"><code>R/cf_age.R</code></a></small>
    <div class="hidden name"><code>cf_age.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Removes or flags records that are temporal outliers based on
interquantile ranges.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">cf_age</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  lon <span class="op">=</span> <span class="st">"decimalLongitude"</span>,</span>
<span>  lat <span class="op">=</span> <span class="st">"decimalLatitude"</span>,</span>
<span>  min_age <span class="op">=</span> <span class="st">"min_ma"</span>,</span>
<span>  max_age <span class="op">=</span> <span class="st">"max_ma"</span>,</span>
<span>  taxon <span class="op">=</span> <span class="st">"accepted_name"</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"quantile"</span>,</span>
<span>  size_thresh <span class="op">=</span> <span class="fl">7</span>,</span>
<span>  mltpl <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  replicates <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  flag_thresh <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  uniq_loc <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  value <span class="op">=</span> <span class="st">"clean"</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>x</dt>
<dd><p>data.frame. Containing fossil records with taxon names, ages, 
and geographic coordinates.</p></dd>


<dt>lon</dt>
<dd><p>character string. The column with the longitude coordinates.
To identify unique records if <code>uniq_loc  = TRUE</code>.
Default = “decimalLongitude”.</p></dd>


<dt>lat</dt>
<dd><p>character string. The column with the longitude coordinates.
Default = “decimalLatitude”. To identify unique records if <code>uniq_loc  = T</code>.</p></dd>


<dt>min_age</dt>
<dd><p>character string. The column with the minimum age. Default
= “min_ma”.</p></dd>


<dt>max_age</dt>
<dd><p>character string. The column with the maximum age. Default
= “max_ma”.</p></dd>


<dt>taxon</dt>
<dd><p>character string. The column with the taxon name. If
“”, searches for outliers over the entire dataset, otherwise per
specified taxon. Default = “accepted_name”.</p></dd>


<dt>method</dt>
<dd><p>character string.  Defining the method for outlier
selection.  See details. Either “quantile” or “mad”.  Default
= “quantile”.</p></dd>


<dt>size_thresh</dt>
<dd><p>numeric.  The minimum number of records needed for a
dataset to be tested. Default = 10.</p></dd>


<dt>mltpl</dt>
<dd><p>numeric. The multiplier of the interquartile range
(<code>method == 'quantile'</code>) or median absolute deviation (<code>method ==
'mad'</code>) to identify outliers. See details.  Default = 5.</p></dd>


<dt>replicates</dt>
<dd><p>numeric. The number of replications for the distance
matrix calculation. See details.  Default = 5.</p></dd>


<dt>flag_thresh</dt>
<dd><p>numeric.  The fraction of passed replicates necessary to pass the test. 
See details. Default = 0.5.</p></dd>


<dt>uniq_loc</dt>
<dd><p>logical.  If TRUE only single records per location and time
point (and taxon if <code>taxon</code> != "") are used for the outlier testing.
Default = T.</p></dd>


<dt>value</dt>
<dd><p>character string.  Defining the output value. See value.</p></dd>


<dt>verbose</dt>
<dd><p>logical. If TRUE reports the name of the test and the number
of records flagged.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>Depending on the ‘value’ argument, either a <code>data.frame</code></p>


<p>containing the records considered correct by the test (“clean”) or a
  logical vector (“flagged”), with TRUE = test passed and FALSE = test
  failed/potentially problematic . Default = “clean”.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>The outlier detection is based on an interquantile range test. A temporal
distance matrix among all records is calculated based on a single point selected by random
between the minimum and maximum age for each record. The mean distance for
each point to all neighbours is calculated and the sum of these distances
is then tested against the interquantile range and flagged as an outlier if
\(x &gt; IQR(x) + q_75 * mltpl\). The test is replicated ‘replicates’
times, to account for dating uncertainty. Records are flagged as outliers
if they are flagged by a fraction of more than ‘flag.thresh’
replicates. Only datasets/taxa comprising more than ‘size_thresh’
records are tested. Distance are calculated as Euclidean distance.</p>
    </div>
    <div id="note">
    <h2>Note</h2>
    <p>See <a href="https://ropensci.github.io/CoordinateCleaner/" class="external-link">https://ropensci.github.io/CoordinateCleaner/</a> for more
details and tutorials.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>Other fossils: 
<code><a href="cf_equal.html">cf_equal</a>()</code>,
<code><a href="cf_outl.html">cf_outl</a>()</code>,
<code><a href="cf_range.html">cf_range</a>()</code>,
<code><a href="write_pyrate.html">write_pyrate</a>()</code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">minages</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">11</span>, min <span class="op">=</span> <span class="fl">10</span>, max <span class="op">=</span> <span class="fl">25</span><span class="op">)</span>, <span class="fl">62.5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"z"</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                min_ma <span class="op">=</span> <span class="va">minages</span>,</span></span>
<span class="r-in"><span>                max_ma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">minages</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">11</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">11</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>, <span class="fl">65</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">cf_age</span><span class="op">(</span><span class="va">x</span>, value <span class="op">=</span> <span class="st">"flagged"</span>, taxon <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Testing temporal outliers on dataset level</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Flagged 1 records.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     1     2     3     4     5     6     7     8     9    10    11    12 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># unique locations only</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"z"</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                decimalLongitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span>, min <span class="op">=</span> <span class="fl">4</span>, max <span class="op">=</span> <span class="fl">16</span><span class="op">)</span>, <span class="fl">75</span>, <span class="fl">7</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                decimalLatitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">12</span>, min <span class="op">=</span> <span class="op">-</span><span class="fl">5</span>, max <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                min_ma <span class="op">=</span> <span class="va">minages</span>, </span></span>
<span class="r-in"><span>                max_ma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">minages</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">11</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">11</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>, <span class="fl">65</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">cf_age</span><span class="op">(</span><span class="va">x</span>, value <span class="op">=</span> <span class="st">"flagged"</span>, taxon <span class="op">=</span> <span class="st">""</span>, uniq_loc <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Testing temporal outliers on dataset level</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Flagged 1 records.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     1     2     3     4     5     6     7     8     9    10    11    12 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE </span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Alexander Zizka.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

