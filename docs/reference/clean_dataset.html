<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Coordinate Cleaning using Dataset Properties — clean_dataset • CoordinateCleaner</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Coordinate Cleaning using Dataset Properties — clean_dataset"><meta property="og:description" content="Tests for problems associated with coordinate conversions and rounding,
based on dataset properties. Includes test to identify contributing datasets with
potential errors with converting ddmm to dd.dd, and
periodicity in the data decimals indicating rounding or a raster basis
linked to low coordinate precision. Specifically:
ddmm  tests for erroneous conversion from a degree
minute format (ddmm) to a decimal degree (dd.dd) format
periodicity test for periodicity in the data,
which can indicate imprecise coordinates, due to rounding or rasterization.

"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">CoordinateCleaner</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/Cleaning_GBIF_data_with_CoordinateCleaner.html">Cleaning GBIF data for the use in biogeography</a>
    </li>
    <li>
      <a href="../articles/Cleaning_PBDB_fossils_with_CoordinateCleaner.html">Cleaning fossil data for the use in biogeography and palaeontology</a>
    </li>
    <li>
      <a href="../articles/Comparison_other_software.html">Comparison of CoordinateCleaner to other tools</a>
    </li>
    <li>
      <a href="../articles/Using_custom_gazetteers.html">Using customized gazetteers</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/ropensci/CoordinateCleaner/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Coordinate Cleaning using Dataset Properties</h1>
    <small class="dont-index">Source: <a href="https://github.com/ropensci/CoordinateCleaner/blob/HEAD/R/clean_dataset.R" class="external-link"><code>R/clean_dataset.R</code></a></small>
    <div class="hidden name"><code>clean_dataset.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Tests for problems associated with coordinate conversions and rounding,
based on dataset properties. Includes test to identify contributing datasets with
potential errors with converting ddmm to dd.dd, and
periodicity in the data decimals indicating rounding or a raster basis
linked to low coordinate precision. Specifically:</p><ul><li><p>ddmm  tests for erroneous conversion from a degree
minute format (ddmm) to a decimal degree (dd.dd) format</p></li>
<li><p>periodicity test for periodicity in the data,
which can indicate imprecise coordinates, due to rounding or rasterization.</p></li>
</ul></div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">clean_dataset</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  lon <span class="op">=</span> <span class="st">"decimalLongitude"</span>,</span>
<span>  lat <span class="op">=</span> <span class="st">"decimalLatitude"</span>,</span>
<span>  ds <span class="op">=</span> <span class="st">"dataset"</span>,</span>
<span>  tests <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ddmm"</span>, <span class="st">"periodicity"</span><span class="op">)</span>,</span>
<span>  value <span class="op">=</span> <span class="st">"dataset"</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>x</dt>
<dd><p>data.frame. Containing geographical coordinates and species names.</p></dd>


<dt>lon</dt>
<dd><p>character string. The column with the longitude coordinates.
Default = “decimalLongitude”.</p></dd>


<dt>lat</dt>
<dd><p>character string. The column with the latitude coordinates.
Default = “decimalLatitude”.</p></dd>


<dt>ds</dt>
<dd><p>a character string. The column with the dataset of each record. In
case <code>x</code> should be treated as a single dataset, identical for all
records. Default = “dataset”.</p></dd>


<dt>tests</dt>
<dd><p>a vector of character strings, indicating which tests to run.
See details for all tests available. Default = c("ddmm", "periodicity")</p></dd>


<dt>value</dt>
<dd><p>a character string.  Defining the output value. See value.
Default = “dataset”.</p></dd>


<dt>verbose</dt>
<dd><p>logical. If TRUE reports the name of the test and the number
of records flagged.</p></dd>


<dt>...</dt>
<dd><p>additional arguments to be passed to <code><a href="cd_ddmm.html">cd_ddmm</a></code> and
<code><a href="cd_round.html">cd_round</a></code> to customize test sensitivity.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>Depending on the ‘value’ argument:</p><dl><dt>“dataset”</dt>
<dd><p>a <code>data.frame</code> with the
the test summary statistics for each dataset in <code>x</code></p></dd>

<dt>“clean”</dt>
<dd><p>a <code>data.frame</code> containing only
records from datasets in <code>x</code> that passed the tests</p></dd>

<dt>“flagged”</dt>
<dd><p>a logical vector of the same length as
rows in <code>x</code>, with TRUE = test passed and
FALSE = test failed/potentially problematic.</p></dd>


</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>These tests are based on the statistical distribution of coordinates and
their decimals within
datasets of geographic distribution records to identify datasets with
potential errors/biases. Three potential error sources can be identified.
The ddmm flag tests for the particular pattern that emerges if geographical
coordinates in a degree minute annotation are transferred into decimal
degrees, simply replacing the degree symbol with the decimal point. This
kind of problem has been observed by in older datasets first recorded on
paper using typewriters, where e.g. a floating point was used as symbol for
degrees. The function uses a binomial test to check if more records than
expected have decimals below 0.6 (which is the maximum that can be obtained
in minutes, as one degree has 60 minutes) and if the number of these records
is higher than those above 0.59 by a certain proportion. The periodicity
test uses rate estimation in a Poisson process to estimate if there is
periodicity in the decimals of a dataset (as would be expected by for
example rounding or data that was collected in a raster format) and if there
is an over proportional number of records with the decimal 0 (full degrees)
which indicates rounding and thus low precision. The default values are
empirically optimized by with GBIF data, but should probably be adapted.</p>
    </div>
    <div id="note">
    <h2>Note</h2>
    <p>See <a href="https://ropensci.github.io/CoordinateCleaner/" class="external-link">https://ropensci.github.io/CoordinateCleaner/</a> for more details
and tutorials.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="cd_ddmm.html">cd_ddmm</a></code> <code><a href="cd_round.html">cd_round</a></code></p>
<p>Other Wrapper functions: 
<code><a href="clean_coordinates.html">clean_coordinates</a>()</code>,
<code><a href="clean_fossils.html">clean_fossils</a>()</code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">#Create test dataset</span></span></span>
<span class="r-in"><span><span class="va">clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"clean"</span>, <span class="fl">1000</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                    decimalLongitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>min <span class="op">=</span> <span class="op">-</span><span class="fl">43</span>, max <span class="op">=</span> <span class="op">-</span><span class="fl">40</span>, n <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                    decimalLatitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>min <span class="op">=</span> <span class="op">-</span><span class="fl">13</span>, max <span class="op">=</span> <span class="op">-</span><span class="fl">10</span>, n <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>                    </span></span>
<span class="r-in"><span><span class="va">bias.long</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>min <span class="op">=</span> <span class="op">-</span><span class="fl">42</span>, max <span class="op">=</span> <span class="op">-</span><span class="fl">40</span>, n <span class="op">=</span> <span class="fl">500</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>               <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>min <span class="op">=</span> <span class="op">-</span><span class="fl">42</span>, max <span class="op">=</span> <span class="op">-</span><span class="fl">40</span>, n <span class="op">=</span> <span class="fl">300</span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>               <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>min <span class="op">=</span> <span class="op">-</span><span class="fl">42</span>, max <span class="op">=</span> <span class="op">-</span><span class="fl">40</span>, n <span class="op">=</span> <span class="fl">200</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">bias.lat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>min <span class="op">=</span> <span class="op">-</span><span class="fl">12</span>, max <span class="op">=</span> <span class="op">-</span><span class="fl">10</span>, n <span class="op">=</span> <span class="fl">500</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>              <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>min <span class="op">=</span> <span class="op">-</span><span class="fl">12</span>, max <span class="op">=</span> <span class="op">-</span><span class="fl">10</span>, n <span class="op">=</span> <span class="fl">300</span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>              <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>min <span class="op">=</span> <span class="op">-</span><span class="fl">12</span>, max <span class="op">=</span> <span class="op">-</span><span class="fl">10</span>, n <span class="op">=</span> <span class="fl">200</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">bias</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"biased"</span>, <span class="fl">1000</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                   decimalLongitude <span class="op">=</span> <span class="va">bias.long</span>,</span></span>
<span class="r-in"><span>                   decimalLatitude <span class="op">=</span> <span class="va">bias.lat</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">clean</span>, <span class="va">bias</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span>                  </span></span>
<span class="r-in"><span><span class="co">#run clean_dataset</span></span></span>
<span class="r-in"><span><span class="va">flags</span> <span class="op">&lt;-</span> <span class="fu">clean_dataset</span><span class="op">(</span><span class="va">test</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#check problems</span></span></span>
<span class="r-in"><span><span class="co">#clean</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">test</span><span class="op">[</span><span class="va">test</span><span class="op">$</span><span class="va">dataset</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">flags</span><span class="op">[</span><span class="va">flags</span><span class="op">$</span><span class="va">summary</span>,<span class="op">]</span><span class="op">)</span>, <span class="st">"decimalLongitude"</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#biased</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">test</span><span class="op">[</span><span class="va">test</span><span class="op">$</span><span class="va">dataset</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">flags</span><span class="op">[</span><span class="op">!</span><span class="va">flags</span><span class="op">$</span><span class="va">summary</span>,<span class="op">]</span><span class="op">)</span>, <span class="st">"decimalLongitude"</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Alexander Zizka.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

