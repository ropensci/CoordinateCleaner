<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using customized gazetteers • CoordinateCleaner</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using customized gazetteers">
<meta property="og:description" content="CoordinateCleaner">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">CoordinateCleaner</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.0-18</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Cleaning_GBIF_data_with_CoordinateCleaner.html">Cleaning GBIF data for the use in biogeography</a>
    </li>
    <li>
      <a href="../articles/Cleaning_PBDB_fossils_with_CoordinateCleaner.html">Cleaning fossil data for the use in biogeography and palaeontology</a>
    </li>
    <li>
      <a href="../articles/Comparison_other_software.html">Comparison of CoordinateCleaner to other tools</a>
    </li>
    <li>
      <a href="../articles/Using_custom_gazetteers.html">Using customized gazetteers</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ropensci/CoordinateCleaner/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Using_custom_gazetteers_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Using customized gazetteers</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/CoordinateCleaner/blob/master/vignettes/Using_custom_gazetteers.Rmd"><code>vignettes/Using_custom_gazetteers.Rmd</code></a></small>
      <div class="hidden name"><code>Using_custom_gazetteers.Rmd</code></div>

    </div>

    
    
<p>CoordinateCleaner identifies potentially erroneous geographic records with coordinates assigned to the sea, countr coordinate, country capitals, urban areas, institutions, the GBIF headquarters and countries based on the comparison with geographic gazetteers (i.e. reference databases). All of these functions include default reference databases compiled from various sources. These default references have been selected suitable for regional to global analyses. They will also work for smaller scale analyses, but in some case different references might be desirable and available. this could be for instance centroids of small scale political units, a different set of urban areas, or a different coastline when working with coastal species. To account for this, each <em>CoordinateCleaner</em> function using a gazetteer has a <code>ref</code> argument to specify custom gazetteers.</p>
<p>We will use the case of coastlines and a coastal species to demonstrate the application of custom gazetteers. The purpose of <code>cc_sea</code> is to flag records in the sea, since these often represent erroneous and undesired records for terrestrial organisms. The standard gazetteer for this function is fetched from naturalearthdata.com at a 1:50m scale. However, often coordinates available from public databases are only precise at the scale of kilometres, which might lead to an overly critical flagging of coordinates close to the coastline, which is a problem especially for coastal or intertidal species. WE illustrate the issue on for the mangrove tree genus <em>Avicennia</em>.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">CoordinateCleaner</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">rgbif</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">sp</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">viridis</span>)


<span class="co">#download data from GBIF</span>
<span class="no">dat</span> <span class="kw">&lt;-</span> <span class="kw pkg">rgbif</span><span class="kw ns">::</span><span class="fu"><a href="https://docs.ropensci.org/rgbif/reference/occ_search.html">occ_search</a></span>(<span class="kw">scientificName</span> <span class="kw">=</span> <span class="st">"Avicennia"</span>, <span class="kw">limit</span> <span class="kw">=</span> <span class="fl">1000</span>,
         <span class="kw">hasCoordinate</span> <span class="kw">=</span> <span class="no">T</span>)

<span class="no">dat</span> <span class="kw">&lt;-</span> <span class="no">dat</span>$<span class="no">data</span>

<span class="no">dat</span> <span class="kw">&lt;-</span>  <span class="no">dat</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="kw">species</span> <span class="kw">=</span> <span class="no">name</span>, <span class="kw">decimallongitude</span> <span class="kw">=</span> <span class="no">decimalLongitude</span>,
         <span class="kw">decimallatitude</span> <span class="kw">=</span> <span class="no">decimalLatitude</span>, <span class="no">countryCode</span>)

<span class="co"># run with default gazetteer</span>
<span class="no">outl</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/cc_sea.html">cc_sea</a></span>(<span class="no">dat</span>, <span class="kw">value</span> <span class="kw">=</span> <span class="st">"flagged"</span>)
<span class="co">## OGR data source with driver: ESRI Shapefile </span>
<span class="co">## Source: "C:\Users\az64mycy\AppData\Local\Temp\RtmpEb6luF", layer: "ne_110m_land"</span>
<span class="co">## with 127 features</span>
<span class="co">## It has 3 fields</span>

<span class="no">plo</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="no">dat</span>, <span class="kw">outlier</span> <span class="kw">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(!<span class="no">outl</span>))

<span class="co">#plot results</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>()+
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/borders.html">borders</a></span>(<span class="kw">fill</span> <span class="kw">=</span> <span class="st">"grey60"</span>)+
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">plo</span>,
             <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">decimallongitude</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">decimallatitude</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="no">outlier</span>))+
  <span class="fu"><a href="https://rdrr.io/pkg/viridis/man/scale_viridis.html">scale_color_viridis</a></span>(<span class="kw">discrete</span> <span class="kw">=</span> <span class="no">T</span>, <span class="kw">name</span> <span class="kw">=</span> <span class="st">"Flagged outlier"</span>)+
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed</a></span>()+
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()+
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">"bottom"</span>)</pre></body></html></div>
<div class="figure">
<img src="../../../../../Dropbox%20(iDiv)/research_projects/00_CoordinateCleaner/CoordinateCleaner/vignettes/cusgaz1-1.png" alt=""><p class="caption">plot of chunk cusgaz1</p>
</div>
<p>A large number of the coastal records gets flagged, which in this case is undesirable, because it is not a function of the records being wrong, but rather of the precision of the coordinates and the resolution of the reference. To avoid this problem you can use a buffered reference, which avoids flagging records close to the coast line and only flags records from the open ocean. <em>CoordinateCleaner</em> comes with a one degree buffered reference (<code>buffland</code>). In case a narrower or distance true buffer is necessary, you can provide any SpatialPolygonsDataFrame similar in structure to <code>buffland</code> via the <code>ref</code> argument.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="co"># The buffered custom gazetteer</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"buffland"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">buffland</span>)</pre></body></html></div>
<div class="figure">
<img src="../../../../../Dropbox%20(iDiv)/research_projects/00_CoordinateCleaner/CoordinateCleaner/vignettes/cusgaz2-1.png" alt=""><p class="caption">plot of chunk cusgaz2</p>
</div>
<div class="sourceCode" id="cb3"><html><body><pre class="r">
<span class="co"># run with custom gazetteer</span>
<span class="no">outl</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/cc_sea.html">cc_sea</a></span>(<span class="no">dat</span>, <span class="kw">value</span> <span class="kw">=</span> <span class="st">"flagged"</span>, <span class="kw">ref</span> <span class="kw">=</span> <span class="no">buffland</span>)

<span class="no">plo</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="no">dat</span>, <span class="kw">outlier</span> <span class="kw">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(!<span class="no">outl</span>))

<span class="co">#plot results</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>()+
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/borders.html">borders</a></span>(<span class="kw">fill</span> <span class="kw">=</span> <span class="st">"grey60"</span>)+
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">plo</span>,
             <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">decimallongitude</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">decimallatitude</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="no">outlier</span>))+
  <span class="fu"><a href="https://rdrr.io/pkg/viridis/man/scale_viridis.html">scale_color_viridis</a></span>(<span class="kw">discrete</span> <span class="kw">=</span> <span class="no">T</span>, <span class="kw">name</span> <span class="kw">=</span> <span class="st">"Flagged outlier"</span>)+
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed</a></span>()+
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()+
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">"bottom"</span>)</pre></body></html></div>
<div class="figure">
<img src="../../../../../Dropbox%20(iDiv)/research_projects/00_CoordinateCleaner/CoordinateCleaner/vignettes/cusgaz2-2.png" alt=""><p class="caption">plot of chunk cusgaz2</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Alexander Zizka.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
